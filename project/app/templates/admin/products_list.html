{% extends "admin/base.html" %}

{% block title %}–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}

{% block content %}
<h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h1>

<!-- –î–µ–π—Å—Ç–≤–∏—è -->
<div class="admin-actions">
    <a href="{{ url_for('admin.upload_products') }}" class="btn btn-primary">
        üì¶ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV
    </a>
    <a href="{{ url_for('admin.download_products') }}" class="btn btn-outline">
        ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å CSV
    </a>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filters-section">
    <form method="GET" class="filters-form">
        <div class="filter-group">
            <input type="text" name="search" value="{{ search }}" 
                   placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, SKU, –æ–ø–∏—Å–∞–Ω–∏—é..." class="search-input">
        </div>
        
        <div class="filter-group">
            <select name="category" class="filter-select">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                {% for cat in categories %}
                    <option value="{{ cat }}" {% if category_filter == cat %}selected{% endif %}>
                        {{ cat }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-secondary">–ù–∞–π—Ç–∏</button>
        <a href="{{ url_for('admin.products_list') }}" class="btn btn-outline">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
{% if products %}
    <div class="products-table">
        <table>
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                    <tr>
                        <td>
                            <a href="{{ url_for('admin.edit_product', sku=product.sku) }}" 
                            class="btn btn-small btn-secondary">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </a>
                            <a href="{{ url_for('public.product_detail', sku=product.sku) }}" 
                            target="_blank" class="btn btn-small btn-outline">
                            üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                            </a>
                        </td>
                        
                        <td>
                            <span class="sku-badge">{{ product.sku }}</span>
                        </td>
                        <td>
                            {% if product.images %}
                                <img src="{{ product.images[0] }}" alt="{{ product.title }}" 
                                     class="product-thumb" 
                                     onerror="this.src='/static/img/no-image.jpg'">
                            {% else %}
                                <div class="no-image">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
                            {% endif %}
                        </td>
                        <td>
                            <div class="product-info">
                                <strong>{{ product.title }}</strong>
                                {% if product.description %}
                                    <div class="product-desc">
                                        {{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
                                    </div>
                                {% endif %}
                                {% if product.volume_ml %}
                                    <div class="product-volume">–û–±—ä–µ–º: {{ product.volume_ml }} –º–ª</div>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <span class="category-tag">{{ product.category }}</span>
                        </td>
                        <td class="price-cell">
                            <strong>{{ product.price }} ‚ÇΩ</strong>
                        </td>
                        <td class="price-cell">
                            {% if product.old_price %}
                                <span class="old-price">{{ product.old_price }} ‚ÇΩ</span>
                            {% else %}
                                <span class="no-price">‚Äî</span>
                            {% endif %}
                        </td>
                        <td class="stock-cell">
                            <span class="stock-value {% if product.stock <= 0 %}out-of-stock{% elif product.stock <= 5 %}low-stock{% else %}in-stock{% endif %}">
                                {{ product.stock }}
                            </span>
                        </td>
                        <td>
                            {% if product.is_active %}
                                <span class="status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            {% else %}
                                <span class="status-inactive">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('public.product_detail', sku=product.sku) }}" 
                               target="_blank" class="btn btn-small btn-outline">
                               üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if total_pages > 1 %}
        <div class="pagination">
            {% for page in range(1, total_pages + 1) %}
                {% if page == current_page %}
                    <span class="page-current">{{ page }}</span>
                {% else %}
                    <a href="{{ url_for('admin.products_list', 
                              page=page, 
                              search=search, 
                              category=category_filter) }}" 
                       class="page-link">{{ page }}</a>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
{% else %}
    <div class="no-products">
        <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ CSV.</p>
        <a href="{{ url_for('admin.upload_products') }}" class="btn btn-primary">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
        </a>
    </div>
{% endif %}
{% endblock %}