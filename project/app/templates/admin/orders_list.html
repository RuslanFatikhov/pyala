{% extends "admin/base.html" %}

{% block title %}Заказы{% endblock %}

{% block content %}
<h1>Заказы</h1>

<!--div class="orders-controls">
    <form method="GET" class="filter-form">
        <label>Статус:</label>
        <select name="status" onchange="this.form.submit()">
            <option value="">Все статусы</option>
            <option value="new" {% if status_filter == 'new' %}selected{% endif %}>Новые</option>
            <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>В обработке</option>
            <option value="shipped" {% if status_filter == 'shipped' %}selected{% endif %}>Отправлены</option>
            <option value="done" {% if status_filter == 'done' %}selected{% endif %}>Выполнены</option>
            <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Отменены</option>
        </select>
    </form>
    
    <a href="{{ url_for('admin.download_orders') }}" class="btn btn-outline">Экспорт CSV</a>
</div-->

<div class="orders-table">
    <table>
        <!--thead>
            <tr>
                <th>№ заказа</th>
                <th>Дата</th>
                <th>Клиент</th>
                <th>Телефон</th>
                <th>Город</th>
                <th>Товары</th>
                <th>Сумма</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead-->
        <tbody>
            {% for order in orders %}
                <tr>
                    <td>{{ order.order_id }}</td>
                    <td>{{ order.created_at }}</td>
                    <td>{{ order.name }}</td>
                    <td>{{ order.phone }}</td>
                    <td>{{ order.city }}</td>
                    <td class="items-cell">
                        {% if order['items'] %}
                            {% for item_str in order['items'].split('|') %}
                                {% if ':' in item_str %}
                                    {% set sku, qty = item_str.split(':') %}
                                    <div>{{ sku }} x{{ qty }}</div>
                                {% else %}
                                    <div>{{ item_str }}</div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <div>Нет товаров</div>
                        {% endif %}
                    </td>
                    <td>{{ order.total }} ₽</td>
                    <td>
                        <span class="status status-{{ order.status }}">
                            {% if order.status == 'new' %}Новый
                            {% elif order.status == 'in_progress' %}В обработке
                            {% elif order.status == 'shipped' %}Отправлен
                            {% elif order.status == 'done' %}Выполнен
                            {% elif order.status == 'cancelled' %}Отменен
                            {% else %}{{ order.status }}
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <form method="POST" action="{{ url_for('admin.update_order_status', order_id=order.order_id) }}" class="status-form">
                            <select name="status" onchange="this.form.submit()">
                                <option value="new" {% if order.status == 'new' %}selected{% endif %}>Новый</option>
                                <option value="in_progress" {% if order.status == 'in_progress' %}selected{% endif %}>В обработке</option>
                                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Отправлен</option>
                                <option value="done" {% if order.status == 'done' %}selected{% endif %}>Выполнен</option>
                                <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Отменен</option>
                            </select>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="9" class="no-orders">Заказы не найдены</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}