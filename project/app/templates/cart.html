<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина - Керамические пиалы</title>

    <!--CSS-->
    <link href="{{ url_for('static', filename='css/reset.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/typo.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/colors.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/product.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/button.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/notifications.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/cart.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/modal.css') }}" rel="stylesheet">

    <!--JS-->
    <script src="{{ url_for('static', filename='js/notifications.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</head>
<body>
    <div class="container">

        <!-- Header -->
        <span class="page-header">
            <span><h1 class="color-1">Корзина</h1></span>
            
            <!--Кнопка закрытия корзины (Кнопка назад)-->
            <button class="button-close">
                <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Закрыть">
            </button>
        </span>
        
        <div class="card-body">

            <!-- Cart Items -->
            {% if cart_items %}
                <!-- ИСПРАВЛЕНО: Используем namespace для накопления суммы -->
                {% set ns = namespace(total=0) %}
                
                <div class="cart-items">
                    {% for item in cart_items %}
                        <div class="cart-item" data-sku="{{ item.product.sku }}">
                            <div class="item-image">
                                {% if item.product.images %}
                                    <img src="{{ item.product.images[0] }}" alt="{{ item.product.title }}">
                                {% else %}
                                    <div class="no-image">Нет фото</div>
                                {% endif %}
                            </div>
                            
                            <div class="item-info">
                                <h5>{{ item.product.title }}</h5>
                                <p class="item-price">{{ item.product.price }} {{ config.get('CURRENCY', '₽') }}</p>
                            </div>
                            
                            <button class="button-remove" onclick="removeFromCart('{{ item.product.sku }}')">
                                <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Удалить">
                            </button>
                        </div>
                        
                        <!-- ИСПРАВЛЕНО: Правильное накопление суммы через namespace -->
                        {% set ns.total = ns.total + (item.product.price * item.qty) %}
                    {% endfor %}
                </div>
                
                <!-- Cart Summary -->
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Итого:</span>
                        <span class="total-amount">{{ ns.total }} {{ config.get('CURRENCY', '₽') }}</span>
                    </div>
                    
                    <a href="{{ url_for('public.checkout') }}" class="btn-large-color1">
                        Оформить заказ
                    </a>
                </div>
            {% else %}
                <div class="empty-cart">
                    <h2>Ваша корзина пуста</h2>
                    <a href="{{ url_for('public.catalog') }}" class="btn-large-color1">Перейти в каталог</a>
                </div>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
</body>
</html>